(this["webpackJsonpsocial-network"]=this["webpackJsonpsocial-network"]||[]).push([[8],{406:function(e,n,t){"use strict";t.r(n),t.d(n,"ChatPage",(function(){return j}));var r=t(12),c=t.n(r),s=t(21),a=t(70),i=t(384),o=t(0),u=t(375),l=t(394),d=t(3),j=function(){return Object(d.jsx)("div",{children:Object(d.jsx)(b,{})})},b=function(){var e=Object(o.useState)(null),n=Object(i.a)(e,2),t=n[0],r=n[1];return Object(o.useEffect)((function(){var e,n=function(){console.log("CLOSE WS"),setTimeout(t,3e3)};function t(){var t,c;null===(t=e)||void 0===t||t.removeEventListener("close",n),null===(c=e)||void 0===c||c.close(),(e=new WebSocket("wss://social-network.samuraijs.com/handlers/ChatHandler.ashx")).addEventListener("close",n),r(e)}return t(),function(){e.removeEventListener("close",n),e.close()}}),[]),Object(d.jsxs)("div",{children:[Object(d.jsx)(v,{wsChannel:t}),Object(d.jsx)(h,{wsChannel:t})]})},v=function(e){var n=e.wsChannel,t=Object(o.useState)([]),r=Object(i.a)(t,2),c=r[0],s=r[1];return Object(o.useEffect)((function(){var e=function(e){s((function(n){return[].concat(Object(a.a)(n),Object(a.a)(JSON.parse(e.data)))}))};return null===n||void 0===n||n.addEventListener("message",e),function(){null===n||void 0===n||n.removeEventListener("message",e)}}),[n]),Object(d.jsx)("div",{style:{height:"400px",overflowY:"auto"},children:c.map((function(e,n){return Object(d.jsx)(f,{message:e},n)}))})},f=function(e){var n=e.message;return Object(d.jsxs)("div",{children:[Object(d.jsx)("img",{src:n.photo,style:{width:"50px",border:"1px solid grey",padding:"5px",marginRight:"5px"},alt:"img"}),Object(d.jsx)("b",{children:n.userName}),Object(d.jsx)("div",{children:n.message}),Object(d.jsx)("hr",{})]})},h=function(e){var n=e.wsChannel,t=Object(o.useState)(""),r=Object(i.a)(t,2),a=r[0],j=r[1],b=Object(o.useState)("pending"),v=Object(i.a)(b,2),f=v[0],h=v[1];Object(o.useEffect)((function(){var e=function(){h("ready")};return null===n||void 0===n||n.addEventListener("open",e),function(){null===n||void 0===n||n.removeEventListener("open",e)}}),[n]);var O=function(){var e=Object(s.a)(c.a.mark((function e(){return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,null===n||void 0===n?void 0:n.send(a);case 4:j("");case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return Object(d.jsx)("div",{children:Object(d.jsx)(l.c,{enableReinitialize:!0,onSubmit:O,initialValues:{chat:a},children:function(){return Object(d.jsxs)(l.b,{style:{display:"flex",alignItems:"center",marginTop:"10px"},children:[Object(d.jsx)(l.a,{style:{resize:"none"},as:"textarea",name:"chat",placeholder:"Send message",onChange:function(e){return j(e.currentTarget.value)}}),Object(d.jsx)(u.a,{disabled:!n&&"ready"===f,style:{marginLeft:"10px"},htmlType:"submit",children:"Send"})]})}})})}}}]);
//# sourceMappingURL=8.fc5b8c9e.chunk.js.map