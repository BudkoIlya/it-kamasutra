(this["webpackJsonpit-kamasutra"]=this["webpackJsonpit-kamasutra"]||[]).push([[8],{406:function(e,t,n){"use strict";n.r(t),n.d(t,"ChatPage",(function(){return j}));var r=n(12),s=n.n(r),a=n(21),c=n(70),i=n(384),u=n(0),o=n(375),l=n(394),d=n(3),j=function(){return Object(d.jsx)("div",{children:Object(d.jsx)(b,{})})},b=function(){var e=Object(u.useState)(null),t=Object(i.a)(e,2),n=t[0],r=t[1];return Object(u.useEffect)((function(){var e,t=function(){console.log("CLOSE WS"),setTimeout(n,3e3)};function n(){var n,s;null===(n=e)||void 0===n||n.removeEventListener("close",t),null===(s=e)||void 0===s||s.close(),(e=new WebSocket("wss://social-network.samuraijs.com/handlers/ChatHandler.ashx")).addEventListener("close",t),r(e)}return n(),function(){e.removeEventListener("close",t),e.close()}}),[]),Object(d.jsxs)("div",{children:[Object(d.jsx)(v,{wsChannel:n}),Object(d.jsx)(h,{wsChannel:n})]})},v=function(e){var t=e.wsChannel,n=Object(u.useState)([]),r=Object(i.a)(n,2),s=r[0],a=r[1];return Object(u.useEffect)((function(){var e=function(e){a((function(t){return[].concat(Object(c.a)(t),Object(c.a)(JSON.parse(e.data)))}))};return null===t||void 0===t||t.addEventListener("message",e),function(){null===t||void 0===t||t.removeEventListener("message",e)}}),[t]),Object(d.jsx)("div",{style:{height:"400px",overflowY:"auto"},children:s.map((function(e,t){return Object(d.jsx)(f,{message:e},t)}))})},f=function(e){var t=e.message;return Object(d.jsxs)("div",{children:[Object(d.jsx)("img",{src:t.photo,style:{width:"50px",border:"1px solid grey",padding:"5px",marginRight:"5px"},alt:"img"}),Object(d.jsx)("b",{children:t.userName}),Object(d.jsx)("div",{children:t.message}),Object(d.jsx)("hr",{})]})},h=function(e){var t=e.wsChannel,n=Object(u.useState)(""),r=Object(i.a)(n,2),c=r[0],j=r[1],b=Object(u.useState)("pending"),v=Object(i.a)(b,2),f=v[0],h=v[1];Object(u.useEffect)((function(){var e=function(){h("ready")};return null===t||void 0===t||t.addEventListener("open",e),function(){null===t||void 0===t||t.removeEventListener("open",e)}}),[t]);var O=function(){var e=Object(a.a)(s.a.mark((function e(){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(c){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,null===t||void 0===t?void 0:t.send(c);case 4:j("");case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return Object(d.jsx)("div",{children:Object(d.jsx)(l.c,{enableReinitialize:!0,onSubmit:O,initialValues:{chat:c},children:function(){return Object(d.jsxs)(l.b,{style:{display:"flex",alignItems:"center",marginTop:"10px"},children:[Object(d.jsx)(l.a,{style:{resize:"none"},as:"textarea",name:"chat",placeholder:"Send message",onChange:function(e){return j(e.currentTarget.value)}}),Object(d.jsx)(o.a,{disabled:!t&&"ready"===f,style:{marginLeft:"10px"},htmlType:"submit",children:"Send"})]})}})})}}}]);
//# sourceMappingURL=8.8ec05c4b.chunk.js.map