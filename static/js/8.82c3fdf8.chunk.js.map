{"version":3,"sources":["pages/Chat/ChatPage.tsx"],"names":["ChatPage","Chat","useState","wsChannel","setWsChannel","useEffect","ws","closeHandler","console","log","setTimeout","createChannel","removeEventListener","close","WebSocket","addEventListener","Messages","AddMessageForm","messages","setMessages","messageHandler","e","prevMessages","JSON","parse","data","style","height","overflowY","map","m","i","Message","message","src","photo","width","border","padding","marginRight","alt","userName","setMessage","readyStatus","setReadyStatus","openHandler","sendMessage","a","send","enableReinitialize","onSubmit","initialValues","chat","display","alignItems","marginTop","resize","as","name","placeholder","onChange","currentTarget","value","disabled","marginLeft","htmlType"],"mappings":"gPAaaA,EAAqB,kBAChC,8BACE,cAACC,EAAD,OAIEA,EAAiB,WACrB,MAAkCC,mBAA2B,MAA7D,mBAAOC,EAAP,KAAkBC,EAAlB,KAsBA,OArBAC,qBAAU,WACR,IAAIC,EACEC,EAAe,WACnBC,QAAQC,IAAI,YACZC,WAAWC,EAAe,MAE5B,SAASA,IAAiB,IAAD,IACrB,QAAF,EAAAL,SAAA,SAAIM,oBAAoB,QAASL,GAC/B,QAAF,EAAAD,SAAA,SAAIO,SACJP,EAAK,IAAIQ,UACP,iEAECC,iBAAiB,QAASR,GAC7BH,EAAaE,GAGf,OADAK,IACO,WACLL,EAAGM,oBAAoB,QAASL,GAChCD,EAAGO,WAEJ,IAED,gCACE,cAACG,EAAD,CAAUb,UAAWA,IACrB,cAACc,EAAD,CAAgBd,UAAWA,QAK3Ba,EAAsD,SAAC,GAAmB,IAAjBb,EAAgB,EAAhBA,UAC7D,EAAgCD,mBAA4B,IAA5D,mBAAOgB,EAAP,KAAiBC,EAAjB,KAUA,OATAd,qBAAU,WACR,IAAMe,EAAiB,SAACC,GACtBF,GAAY,SAACG,GAAD,4BAAsBA,GAAtB,YAAuCC,KAAKC,MAAMH,EAAEI,YAGlE,OADS,OAATtB,QAAS,IAATA,KAAWY,iBAAiB,UAAWK,GAChC,WACI,OAATjB,QAAS,IAATA,KAAWS,oBAAoB,UAAWQ,MAE3C,CAACjB,IAEF,qBAAKuB,MAAO,CAAEC,OAAQ,QAASC,UAAW,QAA1C,SACGV,EAASW,KAAI,SAACC,EAAoBC,GAArB,OAEZ,aADA,CACCC,EAAD,CAASC,QAASH,GAAQC,SAK5BC,EAAkD,SAAC,GAAD,IAAGC,EAAH,EAAGA,QAAH,OACtD,gCACE,qBACEC,IAAKD,EAAQE,MACbT,MAAO,CACLU,MAAO,OACPC,OAAQ,iBACRC,QAAS,MACTC,YAAa,OAEfC,IAAI,QAEN,4BAAIP,EAAQQ,WACZ,8BAAMR,EAAQA,UACd,2BAGEhB,EAA4D,SAAC,GAE5D,IADLd,EACI,EADJA,UAEA,EAA8BD,mBAAS,IAAvC,mBAAO+B,EAAP,KAAgBS,EAAhB,KACA,EAAsCxC,mBACpC,WADF,mBAAOyC,EAAP,KAAoBC,EAApB,KAGAvC,qBAAU,WACR,IAAMwC,EAAc,WAClBD,EAAe,UAGjB,OADS,OAATzC,QAAS,IAATA,KAAWY,iBAAiB,OAAQ8B,GAC7B,WACI,OAAT1C,QAAS,IAATA,KAAWS,oBAAoB,OAAQiC,MAExC,CAAC1C,IACJ,IAAM2C,EAAW,uCAAG,sBAAAC,EAAA,yDACbd,EADa,wEAEZ9B,QAFY,IAEZA,OAFY,EAEZA,EAAW6C,KAAKf,GAFJ,OAGlBS,EAAW,IAHO,2CAAH,qDAKjB,OACE,8BACE,cAAC,IAAD,CACEO,oBAAkB,EAClBC,SAAUJ,EACVK,cAAe,CAAEC,KAAMnB,GAHzB,SAKG,kBACC,eAAC,IAAD,CACEP,MAAO,CAAE2B,QAAS,OAAQC,WAAY,SAAUC,UAAW,QAD7D,UAGE,cAAC,IAAD,CACE7B,MAAO,CAAE8B,OAAQ,QACjBC,GAAG,WACHC,KAAK,OACLC,YAAY,eACZC,SAAU,SAACvC,GAAD,OACRqB,EAAWrB,EAAEwC,cAAcC,UAG/B,cAAC,IAAD,CACEC,UAAW5D,GAA6B,UAAhBwC,EACxBjB,MAAO,CAAEsC,WAAY,QACrBC,SAAS,SAHX","file":"static/js/8.82c3fdf8.chunk.js","sourcesContent":["import React, { useEffect, useState } from 'react';\r\nimport { Button } from 'antd';\r\nimport { Field, Form, Formik } from 'formik';\r\n\r\n// const WS = new WebSocket('wss://social-network.samuraijs.com/handlers/ChatHandler.ashx');\r\n\r\nexport type ChatMessageType = {\r\n  message: string;\r\n  photo: string;\r\n  userId: number;\r\n  userName: string;\r\n};\r\n\r\nexport const ChatPage: React.FC = () => (\r\n  <div>\r\n    <Chat />\r\n  </div>\r\n);\r\n\r\nconst Chat: React.FC = () => {\r\n  const [wsChannel, setWsChannel] = useState<WebSocket | null>(null);\r\n  useEffect(() => {\r\n    let ws: WebSocket;\r\n    const closeHandler = () => {\r\n      console.log('CLOSE WS');\r\n      setTimeout(createChannel, 3000);\r\n    };\r\n    function createChannel() {\r\n      ws?.removeEventListener('close', closeHandler);\r\n      ws?.close();\r\n      ws = new WebSocket(\r\n        'wss://social-network.samuraijs.com/handlers/ChatHandler.ashx'\r\n      );\r\n      ws.addEventListener('close', closeHandler);\r\n      setWsChannel(ws);\r\n    }\r\n    createChannel();\r\n    return () => {\r\n      ws.removeEventListener('close', closeHandler);\r\n      ws.close();\r\n    };\r\n  }, []);\r\n  return (\r\n    <div>\r\n      <Messages wsChannel={wsChannel} />\r\n      <AddMessageForm wsChannel={wsChannel} />\r\n    </div>\r\n  );\r\n};\r\n\r\nconst Messages: React.FC<{ wsChannel: WebSocket | null }> = ({ wsChannel }) => {\r\n  const [messages, setMessages] = useState<ChatMessageType[]>([]);\r\n  useEffect(() => {\r\n    const messageHandler = (e: MessageEvent) => {\r\n      setMessages((prevMessages) => [...prevMessages, ...JSON.parse(e.data)]);\r\n    };\r\n    wsChannel?.addEventListener('message', messageHandler);\r\n    return () => {\r\n      wsChannel?.removeEventListener('message', messageHandler);\r\n    };\r\n  }, [wsChannel]);\r\n  return (\r\n    <div style={{ height: '400px', overflowY: 'auto' }}>\r\n      {messages.map((m: ChatMessageType, i) => (\r\n        // eslint-disable-next-line react/no-array-index-key\r\n        <Message message={m} key={i} />\r\n      ))}\r\n    </div>\r\n  );\r\n};\r\nconst Message: React.FC<{ message: ChatMessageType }> = ({ message }) => (\r\n  <div>\r\n    <img\r\n      src={message.photo}\r\n      style={{\r\n        width: '50px',\r\n        border: '1px solid grey',\r\n        padding: '5px',\r\n        marginRight: '5px',\r\n      }}\r\n      alt=\"img\"\r\n    />\r\n    <b>{message.userName}</b>\r\n    <div>{message.message}</div>\r\n    <hr />\r\n  </div>\r\n);\r\nconst AddMessageForm: React.FC<{ wsChannel: WebSocket | null }> = ({\r\n  wsChannel,\r\n}) => {\r\n  const [message, setMessage] = useState('');\r\n  const [readyStatus, setReadyStatus] = useState<'pending' | 'ready'>(\r\n    'pending'\r\n  );\r\n  useEffect(() => {\r\n    const openHandler = () => {\r\n      setReadyStatus('ready');\r\n    };\r\n    wsChannel?.addEventListener('open', openHandler);\r\n    return () => {\r\n      wsChannel?.removeEventListener('open', openHandler);\r\n    };\r\n  }, [wsChannel]);\r\n  const sendMessage = async () => {\r\n    if (!message) return;\r\n    await wsChannel?.send(message);\r\n    setMessage('');\r\n  };\r\n  return (\r\n    <div>\r\n      <Formik\r\n        enableReinitialize\r\n        onSubmit={sendMessage}\r\n        initialValues={{ chat: message }}\r\n      >\r\n        {() => (\r\n          <Form\r\n            style={{ display: 'flex', alignItems: 'center', marginTop: '10px' }}\r\n          >\r\n            <Field\r\n              style={{ resize: 'none' }}\r\n              as=\"textarea\"\r\n              name=\"chat\"\r\n              placeholder=\"Send message\"\r\n              onChange={(e: React.FormEvent<HTMLInputElement>) =>\r\n                setMessage(e.currentTarget.value)\r\n              }\r\n            />\r\n            <Button\r\n              disabled={!wsChannel && readyStatus === 'ready'}\r\n              style={{ marginLeft: '10px' }}\r\n              htmlType=\"submit\"\r\n            >\r\n              Send\r\n            </Button>\r\n          </Form>\r\n        )}\r\n      </Formik>\r\n    </div>\r\n  );\r\n};\r\n"],"sourceRoot":""}